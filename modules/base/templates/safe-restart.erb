#!/bin/bash

<%- unless @nodes.include?(@facts['networking']['fqdn']) || @nodess.nil? || @nodes.empty? -%>
echo "Safe-restart is not needed here."
systemctl restart <%= @title %>
<%- else -%>
/usr/local/bin/safe-service-restart --api <%= @cache_nodes.map { |host| "http://#{host}:5001" }.join(' ') %> --services <%= @title %> --retries 10 --wait 5 --totp-secret <%= @varnish_totp_secret -%> $@
<%- end -%>
